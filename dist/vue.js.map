{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/gloabAPI.js","../src/compiler/parse.js","../src/compiler/index.js","../src/Observer/dep.js","../src/Observer/watcher.js","../src/vdom/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/Observer/array.js","../src/Observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const strats = {};\r\n\r\n\r\n// 定义钩子\r\nconst LIFYCYCLE = [\r\n  'beforeCreate',\r\n  'created'\r\n]\r\n\r\n\r\n// 处理 mixin中的生命钩子和主页面的生命钩子  合并成数组，然后遍历执行钩子  即调用calHook(vm,hook)函数\r\n// p和c：假装是created函数\r\n// 1.首次进入 p是没有的 所有直接返回 [c], 首次必定有c 不然进入不了   {} =>  [created:fn]\r\n// 2.再次合并 如果 p(即上次返回的 [c] )有,而新的c无 直接返回 p   或者 是 p 有 c有则合并返回\r\nLIFYCYCLE.forEach(hook=>{\r\n  strats[hook] = (p,c)=>{\r\n    if(c){\r\n      if(p){\r\n        return p.concat(c)\r\n      }else{\r\n        return [c]\r\n      }\r\n    }else{\r\n      return p;\r\n    }\r\n  }\r\n})\r\n\r\n\r\nstrats.components = function(parentVal = {},childVal){\r\n  // console.log('parentVal',parentVal,childVal);\r\n  const res = Object.create(parentVal)\r\n\r\n  if(childVal){\r\n    for (const key in childVal) {\r\n      res[key] = childVal[key]  //返回的是构造的对象 ，建立了原型的父子关系\r\n    }\r\n  }\r\n  return res;\r\n}\r\n\r\n// 属性合并\r\nexport function mergeOptions(parent,child){\r\n  const options = {}\r\n\r\n  for (const key in parent) {\r\n    mergeField(key)\r\n  }\r\n\r\n  for (const key in child) {\r\n    if(!parent.hasOwnProperty(key)){\r\n      mergeField(key)\r\n    }\r\n  }\r\n\r\n  // 1.首次所有属性都放入 options 中\r\n  // 2.再次调用 mergeOptions 合并属性时，如果新传入的child中有，并且属性不在LIFYCYCLE中，直接新的属性直接覆盖\r\n  function mergeField(key){\r\n    // console.log('mergeField',key);\r\n    // 如果是LIFYCYCLE中定义的钩子 需要单独处理\r\n    if(strats[key]){\r\n      options[key] = strats[key](parent[key],child[key])\r\n    }else{\r\n      // 如果新的合并回合  父和子都有相同属性 用‘子’也就是（新的mixin中的属性替换旧的mixin中的属性）\r\n      options[key] = child[key] || parent[key];\r\n    }\r\n\r\n  }\r\n\r\n  console.log('options-------------',options);\r\n  return options;\r\n}\r\n\r\n","import { mergeOptions } from \"./utils\";\r\n\r\nexport function initGlobalAPI(Vue){\r\n  // 静态方法\r\n  Vue.options = {\r\n    _base:Vue\r\n  };\r\n  Vue.mixin = function(mixin){\r\n    // console.log('mixin----------',mixin);\r\n    this.options = mergeOptions(this.options,mixin)\r\n  }\r\n\r\n\r\n  Vue.extend = function(options){\r\n    //使用组合继承 \r\n    function Sub(options= {}){\r\n      // debugger\r\n      this._init(options);  //默认对子类进行初始化操作\r\n    }\r\n\r\n    Sub.prototype = Object.create(Vue.prototype)\r\n    Sub.prototype.constructor = Sub\r\n    // debugger\r\n\r\n    // 自己options中components[key](每一个组件)的和全局（Vue.options）的components[key]（每一个组件）建立一个联系（prototype联系）\r\n    // 通过components查找如果自己有使用自己的，如果没有去原型上找找到使用全局的\r\n    Sub.options = mergeOptions(Vue.options,options);\r\n    return Sub;\r\n  }\r\n\r\n  Vue.options.components = {};\r\n  Vue.component = function(id,definition){\r\n\r\n    // 如果definition已经是一个函数了，那么说明用户自己调用了Vue.extend\r\n    // debugger\r\n    definition = typeof definition === 'function'?definition:Vue.extend(definition)\r\n\r\n    Vue.options.components[id] = definition;\r\n  }\r\n}","const ncname = `[a-zA-z_][\\\\-\\\\.0-9_a-zA-z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; \r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); //匹配标签名 <div\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); //匹配结束标签名 </div>\r\n\r\n// 第一个分组就是属性的key value就是分组3/4/5\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; //匹配属性\r\nconst startTagClose = /^\\s*(\\/?)>/; //开始标签的结束 ' > '\r\n\r\n\r\n// 对模板进行编译处理（vue3采用的不是正则）或者使用插件 htmlparser2 解析\r\nexport function parseHTML(html){\r\n  const TEXT_TYPE = 3,  //文本类型\r\n        ELEMENT_TYPE = 1, //元素类型\r\n        stack = []; //存为元素\r\n  let currentParent; //指向栈中的最后一个\r\n  let root; //根节点\r\n\r\n\r\n  // 创建ast树\r\n  function createASTElement(tag,attrs){\r\n    return {\r\n      tag,\r\n      attrs,\r\n      children:[],\r\n      type:ELEMENT_TYPE,\r\n      parent:null\r\n    }\r\n  }\r\n\r\n  // 利用栈型结构，来构造一颗树 通过每次匹配判断标签开始与结束 判断进栈出栈 由此可以清晰知道当前节点所属位置\r\n  function start(tag,attrs){\r\n    let node = createASTElement(tag,attrs)\r\n\r\n    // 看下是否是空树 如果是当前树就是根节点\r\n    if(!root){\r\n      root = node;\r\n    }\r\n\r\n    // 如果当前节点的父节点存在，设置当前节点的父节点，以及给父节点添加儿子节点\r\n    if(currentParent){\r\n      node.parent = currentParent;\r\n      currentParent.children.push(node)\r\n    }\r\n\r\n    // 使用栈的进出判断当前节点以及其父节点\r\n    stack.push(node);\r\n    currentParent = node;\r\n  }\r\n\r\n  function chars(text){\r\n    // 去除所有空格  这里会把文本中的空格也给去除调\r\n    // text = text.replace(/\\s/g,'')\r\n    text = text.trim();\r\n    text && currentParent.children.push({\r\n      type:TEXT_TYPE,\r\n      text,\r\n      parent:currentParent\r\n    })\r\n  }\r\n\r\n  function end(tag){\r\n    stack.pop();\r\n    // 当前父节点，就是栈最后一个\r\n    currentParent = stack[stack.length - 1]\r\n  }\r\n\r\n  \r\n  // 去除匹配到了\r\n  function advance(n){\r\n    html = html.substring(n)\r\n  }\r\n\r\n  // 开始标签匹配处理\r\n  function parseStartTag(){\r\n    const start = html.match(startTagOpen);\r\n    //start: [0: \"<div\"  1: \"div\"]\r\n    if(start){\r\n      const match = {\r\n        tagName:start[1],\r\n        attrs:[]\r\n      }\r\n\r\n      // 匹配到之后 去除匹配开始标签\r\n      advance(start[0].length)\r\n\r\n      let attr,end;\r\n      // 当不是开始标签的结束时，而是属性则一直匹配 \r\n      while( !(end = html.match(startTagClose)) && (attr = html.match(attribute)) ){\r\n        // 将匹配得属性部分删除\r\n        advance(attr[0].length)\r\n\r\n        //通过正则匹配 1是属性名 2是‘：’ 3/4/5位是属性的值  true处理disabled这种属性\r\n        match.attrs.push({name:attr[1],value:attr[3] || attr[4] || attr[5] || true })\r\n      }\r\n\r\n      // 当匹配到开始标签得结束 > 时 删除 > \r\n      if(end){\r\n        advance(end[0].length)\r\n      }\r\n\r\n      return match;\r\n    }\r\n\r\n    return false;\r\n  }\r\n  \r\n  // 通过正则匹配开始标签 结束标签 字符 进行分类处理\r\n  while(html){\r\n    // 为0代表是一个开始标签或者结束标签\r\n    let textEnd = html.indexOf('<');\r\n\r\n    // 开始标签或者结束标签\r\n    if(textEnd == 0){\r\n\r\n      // 当匹配到开始标签\r\n      const startTagMatch = parseStartTag();\r\n      if(startTagMatch){\r\n        // 处理开始标签为ast树\r\n        start(startTagMatch.tagName,startTagMatch.attrs)\r\n        continue;\r\n      }\r\n\r\n      // 如果是结束标签\r\n      const endTagMatch = html.match(endTag)\r\n      if(endTagMatch){\r\n        advance(endTagMatch[0].length)\r\n        end(endTagMatch[1])\r\n        continue;\r\n      }\r\n      break;\r\n    }\r\n\r\n    // 如果是文本\r\n    if(textEnd > 0){\r\n      // 获取文本部分\r\n      const text = html.substring(0,textEnd)\r\n      // 删除文本部分\r\n      advance(text.length)\r\n      // 将文本处理成ast树\r\n      chars(text)\r\n    }\r\n  }\r\n\r\n  return root;\r\n}","import { parseHTML} from \"./parse\";\r\n\r\n\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;  //{{xx}} 匹配表达式的变量\r\n\r\n// 属性切割\r\nfunction genProps(attrs){\r\n  let str = '';\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    let attr = attrs[i];\r\n\r\n    // 如果是style属性单独切割处理\r\n    if(attr.name == 'style'){\r\n      let obj = {};\r\n      attr.value.split(';').map(item=>{\r\n        let [key,value] = item.split(':');\r\n        obj[key] = value;\r\n      })\r\n      attr.value = obj;\r\n    }\r\n\r\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n  }\r\n  return `{${str.slice(0,-1)}}`;\r\n}\r\n\r\nfunction genChildren(children){\r\n  return children.map(child=>gen(child)).join(',')\r\n}\r\n\r\nfunction gen(node){\r\n  // 如果子节点是元素节点再次生成\r\n  if(node.type === 1){\r\n    return codegen(node)\r\n  }else{\r\n    // 如果是文本类型\r\n    let text = node.text;\r\n\r\n    // 如果没有匹配到 {{ }}  注意：/xxx/g.test() /xxx/g.exec(text))  匹配成功后的lastIndex 会变化\r\n    if(!defaultTagRE.test(text)){\r\n      return `_v(${JSON.stringify(text)})`\r\n    }else{\r\n      let tokens = [];\r\n      let match;\r\n      let lastIndex = 0;\r\n      // 这里一定得设置为0 否则只会匹配到最后一个值（是因为使用了g全局匹配会导致这种问题）\r\n      defaultTagRE.lastIndex = 0;\r\n\r\n      // match : [0: \"{{name}}\", 1: \"name\",groups: undefined,index: 0,input: \"{{name}} 今年 {{age}} 岁了， 喜欢打篮球\"]\r\n      while(match = defaultTagRE.exec(text)){\r\n        let index = match.index;  //当前匹配到的下标\r\n\r\n        // 如果匹配的 '文字 {{}} ' 前面还有 其他文本 直接放入\r\n        if(index > lastIndex){\r\n          tokens.push(JSON.stringify(text.slice(lastIndex,index)))\r\n        }\r\n\r\n        // 重新设置当前匹配后的位置\r\n        lastIndex = index + match[0].length;\r\n\r\n        // console.log('match[1]',match[1],`${match[1]}`);\r\n        tokens.push(`_s(${match[1]})`);\r\n      }\r\n      //  匹配完成了 '{{}} 文字' 最后如果还有 文字也得放入进来\r\n      if(lastIndex < text.length){\r\n        tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n      }\r\n\r\n      return `_v(${tokens.join('+')})`\r\n    }\r\n  }\r\n  \r\n}\r\n\r\n// 将ast语法树转换成render函数  _c  _s替换{{}}  _v 文本\r\nfunction codegen(ast){\r\n  let children = genChildren(ast.children)\r\n  let code = (`_c('${ast.tag}',${ast.attrs.length > 0 ? genProps(ast.attrs):'null'}${ast.children.length>0 ? `,${children}`:''})`)\r\n  return code\r\n}\r\n\r\n//对模板进行编译处理\r\nexport function compileToFunction(template){\r\n  // 1. 将template转化成ast树\r\n  const ast = parseHTML(template)\r\n\r\n  // console.log('ast',ast);\r\n\r\n  // 2. 生成render方法 将ast语法树转换成render函数\r\n  // 模板引擎的实现原理 就是 with + new Function\r\n  let code = codegen(ast);\r\n  // console.log('code',this,code);\r\n\r\n  \r\n  // c('div',{id:\"app\",class:\"999\",style:{\"color\":\" #f33\",\"font-size\":\"18px\"}},_c('div',{style:{\"color\":\" #ff3\"}},_v(_s(name)+\" 你 \"+_s(age)+\"  好111\")),_c('span',null,_v(\"hello\")))\r\n  // 因为with 当this传入vm的时候，_s(xxx)中的变量会自动去vm上拿取\r\n  code = `with(this){return ${code}} `;\r\n  let render = new Function(code);\r\n  \r\n  return render;\r\n}","let id = 0;\r\nclass Dep{\r\n  constructor(){\r\n    // console.log('Dep--------',id);\r\n    this.id = id++;\r\n    this.subs = [];\r\n  }\r\n\r\n  depend(){\r\n    // （dep 和 watcher 是多对多的关系  一个属性在多个组件中使用  dep -> 多个watcher）\r\n    // 一个组件中有多个属性 watcher -> 多个dep\r\n\r\n    // this.subs.push(Dep.target)\r\n\r\n    // addDep是watcher的方法\r\n    Dep.target.addDep(this)\r\n  }\r\n\r\n  addSub(watcher){\r\n    this.subs.push(watcher)\r\n  }\r\n\r\n  // watcher 更新\r\n  notify(){\r\n    this.subs.forEach(watcher=>watcher.update())\r\n  }\r\n}\r\n\r\nDep.target = null;\r\n\r\n// 创建栈用于存储多个wathcer\r\nlet stack = [];\r\nexport function pushTarget(watcher){\r\n  Dep.target = watcher;\r\n  stack.push(watcher)\r\n}\r\n\r\nexport function popTarget(){\r\n  stack.pop()\r\n  Dep.target = stack[stack.length - 1];\r\n}\r\n\r\nexport default Dep;","// 即使用观察者模式\r\n// 1.我们可以给模板中的属性 增加一个收集器 dep\r\n// 2.页面渲染的时候，我们将渲染逻辑封装在watcher中  vm._update(vm._render())\r\n// 3.让dep记住这个watcher即可，稍后属性变化了可以找到对应的dep中存放的watcher进行重新渲染\r\n\r\nimport Dep, { popTarget, pushTarget } from \"./dep\";\r\n\r\n//1) 当我们创建渲染watcher的时候我们会把当前的渲染watcher放到Dep.target上\r\n//2) 当调用_render() 会进行取值操作 走到get上\r\n\r\nlet id = 0;\r\nclass Watcher{\r\n  constructor(vm,exprOrFn,options,cb){\r\n    this.id = id++;\r\n    this.vm = vm;\r\n    this.renderWatcher = options;  //true 表示是一个渲染watcher\r\n\r\n    // watch:{name:()=>{}}  exprOrFn:'name'  cb:()=>{}  如果exprOrFn是字符串包裹成函数\r\n    if(typeof exprOrFn === 'string'){\r\n      this.getter = function(){\r\n        return vm[exprOrFn];\r\n      }\r\n    }else{\r\n      this.getter = exprOrFn; \r\n    }\r\n    \r\n    this.deps = [];\r\n    this.depId = new Set();\r\n    this.lazy = options.lazy;  //用于标识自己来源是computed方法\r\n    this.dirty = this.lazy;  //脏值判断（用于判断computed方法是否缓存，是直接把watcher的value返回，否则再次调用evaluate计算新值）\r\n    this.user = options.user; //标识是自己watcher\r\n    this.cb = cb;  //watch方法的回调\r\n\r\n    // 这里存储第一次的值  用作watch的oldVal\r\n    this.value = this.lazy?undefined : this.get();\r\n  }\r\n\r\n  // 一个组件对应多个属性 重复属性不用记录\r\n  addDep(dep){\r\n    if(!this.depId.has(dep.id)){\r\n      this.deps.push(dep)\r\n      this.depId.add(dep.id)\r\n      dep.addSub(this)\r\n    }\r\n  }\r\n\r\n  // 计算属性通过计算watcher获取对应的值\r\n  evaluate(){\r\n    this.value = this.get()\r\n    this.dirty = false; //计算属性计算一次后  缓存计算值\r\n  }\r\n\r\n  // 让当前的计算属性去记住 渲染watcher \r\n  depend(){\r\n    let i = this.deps.length;\r\n    while(i--){\r\n      this.deps[i].depend();\r\n    }\r\n    // console.log('this.deps',this.deps);\r\n  }\r\n\r\n  // 计算属性的 getter只是获取值 并不是更新视图的函数\r\n  get(){\r\n    // console.log('-----this',this);\r\n    pushTarget(this)\r\n    let value = this.getter.call(this.vm);\r\n    popTarget();\r\n    return value;\r\n  }\r\n\r\n  // 设置新值的时候才会走\r\n  update(){\r\n    // 1.当计算属性的 某个值（记住了计算watcher 和 渲染watcher）更改时 会执行dep.notify 对队列中的watcher执行update方法 \r\n    // 2.首先调用计算watcher 设置dirty为真，使计算属性走evaluate方法 更新计算属性值\r\n    // 3.再调用渲染watcher更新视图\r\n    if(this.lazy){\r\n      this.dirty = true;\r\n    }else{\r\n      queueWatcher(this)\r\n    }\r\n    \r\n  }\r\n\r\n  run(){\r\n    console.log('----------run------------');\r\n    let oldVal = this.value;\r\n    let newVal = this.get();\r\n    if(this.user){\r\n      this.cb.call(this.vm,newVal,oldVal)\r\n    }\r\n  }\r\n}\r\n\r\n// （每个属性都有一个dep  watcher相当一个视图）\r\n// 一个组件中 有多个属性（n个属性形成一个视图） n个dep对应一个watcher\r\n// 一个属性对应着多个组件 1个dep对应着多个watcher \r\n// dep 和 watcher 多对多的关系\r\n\r\n\r\n// 使用队列 防止属性多次修改 多次执行更新\r\nlet queue = [];\r\nlet has = {};\r\nlet pending = false;\r\n\r\nfunction flashSchedulerQueue(){\r\n  let flashQueue = queue.slice(0);\r\n  queue = [];\r\n  has = {};\r\n  pending = false;\r\n  flashQueue.forEach(q=>q.run())\r\n}\r\n\r\nfunction queueWatcher(watcher){\r\n  let id = watcher.id;\r\n  if(!has[id]){\r\n    has[id] = true;\r\n    queue.push(watcher);\r\n    \r\n    // 多次修改属性的值  只会执行一次（使用了宏任务setTimeout）\r\n    // 不论update执行多少次 但是最终只执行一轮刷新操作\r\n    if(!pending){\r\n      nextTick(flashSchedulerQueue,0)\r\n      pending =true;\r\n    }\r\n  }\r\n}\r\n\r\nlet callbacks = [];\r\nlet waiting = false;\r\nlet timerFunc;\r\n\r\n// 按照队列顺序执行回调\r\nfunction flashCallback(){\r\n  let cbs = callbacks.slice(0);\r\n  // console.log('cbs--------',cbs);\r\n  callbacks =[];\r\n  waiting = false;\r\n  cbs.forEach(cb=>cb())\r\n}\r\n\r\n// nextTick 不是维护了一个异步任务   而是将这个任务维护到了队列中\r\nexport function nextTick(cb){\r\n  callbacks.push(cb);\r\n  // console.log('cb',callbacks,cb);\r\n  if(!waiting){\r\n    // setTimeout(()=>{\r\n    //   // 最后一起刷新\r\n    //   flashCallback();\r\n    // },0)\r\n    timerFunc();\r\n    waiting= true\r\n  }\r\n} \r\n\r\n// vue中的 nextTick没有直接采用某个api 而是采用优雅降级的方式\r\n// 内部首先采用promise(ie 不兼容) MutationObserver(h5 的api)  ie专项 setImmediate\r\n\r\n\r\nif(Promise){\r\n  timerFunc = ()=>{\r\n    Promise.resolve().then(flashCallback)\r\n  }\r\n}else if(MutationObserver){\r\n  let observer = new MutationObserver(flashCallback)\r\n  let textNode = document.createTextNode(1);\r\n  observer.observe(textNode,{\r\n    characterData:true //节点内容或节点文本的变动。\r\n  })\r\n\r\n  timerFunc = ()=>{\r\n    textNode.textContent = 2;\r\n  }\r\n}else if(setImmediate){\r\n  timerFunc = ()=>{\r\n    setImmediate(flashCallback)\r\n  }\r\n}else{\r\n  timerFunc = ()=>{\r\n    setTimeout(flashCallback)\r\n  }\r\n}\r\n\r\nexport default Watcher;","const isReservedTag = (tag)=>{\r\n  return ['a','div','p','button','ul','li','span'].includes(tag)\r\n}\r\n\r\n//  _h() _c()\r\nexport function createElementVNode(vm,tag,data,...children){\r\n  // console.log('66666666',tag,data,children);\r\n  if(data == null){\r\n    data = {};\r\n  }\r\n  \r\n  // 不明白这里为什么要把key删除\r\n  // let key = data.key;\r\n  // if(key){\r\n  //   delete data.key\r\n  // }\r\n\r\n  // 如果是真实dom\r\n  if(isReservedTag(tag)){\r\n    return vnode(vm,tag,data.key,data,children)\r\n  }else{\r\n    console.log('vm.$options',vm.$options);\r\n    \r\n    let Ctor = vm.$options.components[tag]; //组件的构造函数\r\n    \r\n    // 创建一个组件的虚拟节点\r\n    console.log('createComponentVnod',createComponentVnode(vm,tag,data.key,data,children,Ctor));\r\n    return createComponentVnode(vm,tag,data.key,data,children,Ctor)\r\n  }\r\n}\r\n\r\n// 创建一个组件的虚拟节点\r\nfunction createComponentVnode(vm,tag,key,data,children,Ctor){\r\n  if(typeof Ctor == 'object'){\r\n    Ctor = vm.$options._base.extend(Ctor)\r\n  }\r\n  \r\n\r\n  data.hook = {\r\n    init(vnode){ //稍后创建真实节点的时候，如果是组件则调用此方法\r\n      let instance = vnode.componentInstance = new vnode.componentOptions.Ctor(); \r\n      instance.$mount();\r\n    }\r\n  }\r\n  console.log('data----***',data,vnode(vm,tag,key,data,children,null,{Ctor}));\r\n  \r\n  return vnode(vm,tag,key,data,children,null,{Ctor})\r\n}\r\n\r\n\r\n// _v()\r\nexport function createTextVNode(vm,text){\r\n  // console.log('_v()---------------',vm,text);\r\n  return vnode(vm,undefined,undefined,undefined,undefined,text)\r\n}\r\n\r\n\r\nfunction vnode(vm,tag,key,data,children,text,componentOptions){\r\n  return {\r\n    vm,\r\n    tag,\r\n    key,\r\n    data,\r\n    children,\r\n    text,\r\n    componentOptions\r\n  }\r\n}\r\n\r\n// 比对两个dom元素是否相同\r\nexport function isSameVnode(vnode1,vnode2){\r\n  return vnode1.tag === vnode2.tag && vnode1.key === vnode2.key;\r\n}","import { isSameVnode } from \"./index\";\r\n\r\n// 区分是 组件  还是dom元素\r\nfunction createComponent(vnode){\r\n  let i = vnode.data;\r\n  if((i=i.hook) && (i=i.init)){\r\n    i(vnode)  //初始化组件 \r\n  }\r\n\r\n  // 说明是组件\r\n  if(vnode.componentInstance){\r\n    return true;\r\n  }\r\n}\r\n\r\n// 创建真实DOM元素\r\nexport function createElm(vnode){\r\n  let {tag,data,text,children} = vnode;\r\n\r\n  if(typeof tag === 'string'){\r\n\r\n    if(createComponent(vnode)){\r\n      return vnode.componentInstance.$el;\r\n    }\r\n\r\n    vnode.el = document.createElement(tag)\r\n    patchProps(vnode.el,{},data)\r\n    children.forEach(child => {\r\n      vnode.el.appendChild(createElm(child)) \r\n    });\r\n  }else{\r\n    vnode.el = document.createTextNode(text)\r\n  }\r\n\r\n  return vnode.el;\r\n}\r\n\r\n\r\n// 更新属性\r\nexport function patchProps(el,oldprops = {},props = {}){\r\n  let oldStyle = oldprops.style || {};\r\n  let newStyle = props.style || {};\r\n\r\n  // 如果老节点有新节点无  删除老节点的\r\n  for (const key in oldStyle) {\r\n    if(!newStyle[key]){\r\n      el.style[key] = '';\r\n    }\r\n  }\r\n  for (const key in oldprops) {  //老的属性有  新的属性没有  删除\r\n    if(!props[key]){\r\n      el.removeAttribute(key)\r\n    }\r\n  }\r\n\r\n  for (const key in props) {\r\n    if (key === 'style') {\r\n      for (const styleName in props.style) {\r\n        el.style[styleName] = props.style[styleName];\r\n      }\r\n    }else{\r\n      el.setAttribute(key,props[key])\r\n    }\r\n  }\r\n}\r\n\r\n// 创建真实DOM节点\r\nexport function patch(oldVNode,vnode){\r\n\r\n  if(!oldVNode){ //这就是组件的挂载\r\n    return createElm(vnode)\r\n  }\r\n  // console.log('--------------patch初始化',oldVNode,vnode);\r\n  // 看是否是真实的元素节点\r\n  let isRealElement = oldVNode.nodeType;\r\n  // console.log('isRealElement',oldVNode,vnode,isRealElement);\r\n  if(isRealElement){\r\n    const elm = oldVNode;\r\n\r\n    const parentElm = elm.parentNode;  //拿到父元素\r\n\r\n    // 将虚拟DOM转为真实DOM\r\n    const newElm = createElm(vnode);\r\n\r\n    parentElm.insertBefore(newElm,elm.nextSibling) //插入新节点\r\n\r\n    parentElm.removeChild(elm); //删除老节点\r\n    \r\n    // 将新的节点返回，重新赋值 $el 用于下次更新\r\n    return newElm;\r\n  }else{\r\n    return patchVnode(oldVNode,vnode);\r\n  }\r\n}\r\n\r\n// 更新进入这里  实现diff算法\r\n// 1.两个节点不是同一个节点，直接删除老的换上新的（没有对比）\r\n// 2.两个节点是同一个节点（判断节点tag和节点的key isSameVnode） 比较两个节点的属性是否有差异（复用老的属性，将差异属性进行更新） \r\n// 3节点比较完毕开始比较儿子\r\nfunction patchVnode(oldVNode,vnode){\r\n  // console.log('oldVNode.data',oldVNode,oldVNode.data);\r\n  console.log('vnode.data------',vnode,vnode.data);\r\n\r\n  // 如果两个节点不一样直接用新的节点替换老的节点\r\n  if(!isSameVnode(oldVNode,vnode)){\r\n    let el = createElm(vnode);\r\n    oldVNode.el.parentNode.replaceChild(el,oldVNode.el)\r\n    return el;\r\n  }\r\n\r\n  \r\n  let el = vnode.el = oldVNode.el;  //如果便签相同直接使用老的的标签\r\n\r\n  if(!oldVNode.tag){  // 代表是文本\r\n    if(oldVNode.text !== vnode.text){\r\n      el.textContent = vnode.text;\r\n    }\r\n  }\r\n  \r\n  // 如果是标签相同我们比对属性\r\n  patchProps(el,oldVNode.data,vnode.data)\r\n\r\n  // 比较儿子节点\r\n  let oldChildren = oldVNode.children || [];\r\n  let newChildren = vnode.children || [];\r\n  \r\n  // 1.如果老节点和新节点的儿子节点都存在（重点 updateChildren）\r\n  // 2.老节点儿子不存在，新节点儿子存在直接挂载\r\n  // 3.老节点儿子存在，新节点儿子不存在，直接清空\r\n  // debugger\r\n  if(oldChildren.length > 0 && newChildren.length > 0){\r\n    // console.log('---------------1-------------');\r\n    updateChildren(el,oldChildren,newChildren)\r\n  }else if(newChildren.length > 0){\r\n    mountChildren(el,newChildren);\r\n  }else if(oldChildren.length > 0){\r\n    el.innerHTML = '';\r\n  }\r\n\r\n  return el;\r\n}\r\n\r\nfunction mountChildren(el,newChildren){\r\n  for (let i = 0; i < newChildren.length; i++) {\r\n    let child = createElm(newChildren[i])\r\n    el.appendChild(child)\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * 第一行代表 old 元素  第二行代表新的  头指针 尾指针\r\n  1.头大于尾 (从左往右比对 oldStartIndex：0 newStartIndex:0)\r\n    (a) old: a b c d    (b) old:a b c \r\n        new: a b c          new:a b c d\r\n\r\n  2.尾小于头 (从右往左比对)\r\n    (a) old: a b c d   (b)  old:  b c d\r\n        new:   b c d        new:a b c d\r\n    \r\n  3.首位交叉\r\n    (a) old： a b c d  (b) old：a b c d\r\n        new： b c d a      new：d a b c\r\n\r\n  4.乱序比对\r\n    d c b a \r\n    a b c d\r\n*/\r\n\r\nfunction updateChildren(el,oldChildren,newChildren){\r\n  // diff 算法核心  vue2采用双指针比对\r\n  let oldStartIndex=0;\r\n  let newStartIndex=0;\r\n  let oldEndIndex=oldChildren.length-1;\r\n  let newEndIndex=newChildren.length-1;\r\n\r\n  let oldStartVnode=oldChildren[0];\r\n  let newStartVnode=newChildren[0];\r\n\r\n  let oldEndVnode=oldChildren[oldEndIndex];\r\n  let newEndVnode=newChildren[newEndIndex];\r\n\r\n  // 创建旧节点 字典库  用于判断是否存在相同节点 采取复用\r\n  function makeIndexByKey(children){\r\n    let map = {};\r\n    children.forEach((child,index)=>{\r\n      map[child.key] = index\r\n    })\r\n    return map;\r\n  }\r\n\r\n  console.log('newStartVnode',newStartVnode);\r\n  let map = makeIndexByKey(oldChildren)\r\n  // console.log('map',map);\r\n  \r\n  while(oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex){\r\n    if(!oldStartVnode){// 当乱序复用节点后 处理复用节点变为空的情况\r\n      // console.log('---------------2-------------');\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n    }else if(!oldEndVnode){// 当乱序复用节点后 处理复用节点变为空的情况\r\n      // console.log('---------------3-------------');\r\n      oldEndVnode = oldChildren[--oldEndIndex]\r\n\r\n      // 1.头大于尾（假装顺序比对成功）  双指针 只要一方头指针大于尾指针就结束\r\n      // 如果两个节点相同  头指针后移（同时子节点存在接着递归比对）\r\n    }else if(isSameVnode(oldStartVnode,newStartVnode)){\r\n      // console.log('---------------4-------------');\r\n      patchVnode(oldStartVnode,newStartVnode)  //如果两个节点相同则递归比较子节点\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n      newStartVnode = newChildren[++newStartIndex]\r\n\r\n      // 2.尾小于头（假装顺序比对成功）  双指针 只要一方尾指针小于头指针就结束\r\n      // 如果两个节点相同  尾指针前移（同时子节点存在接着递归比对）\r\n    }else if(isSameVnode(oldEndVnode,newEndVnode)){\r\n      // console.log('---------------5-------------');\r\n      patchVnode(oldEndVnode,newEndVnode)  //如果两个节点相同则递归比较子节点\r\n      oldEndVnode = oldChildren[--oldEndIndex]\r\n      newEndVnode = newChildren[--newEndIndex]\r\n\r\n      // 交叉比对 老的第一个 和 新的最后一个 相同  将老的第一个 移到 老的最后一个\r\n    }else if(isSameVnode(oldStartVnode,newEndVnode)){\r\n      // console.log('---------------6-------------');\r\n      patchVnode(oldStartVnode,newEndVnode)\r\n      // nextSibling 某个元素之后紧跟的元素\r\n      el.insertBefore(oldStartVnode.el,oldEndVnode.el.nextSibling)\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n      newEndVnode = newChildren[--newEndIndex]\r\n\r\n      // 交叉比对 老的最后一个 和 新的第一个 相同  将老的最后一个 移到 老的第一个\r\n    }else if(isSameVnode(oldEndVnode,newStartVnode)){\r\n      // console.log('---------------7-------------');\r\n      patchVnode(oldEndVnode,newStartVnode)\r\n      el.insertBefore(oldEndVnode.el,oldStartVnode.el)\r\n      oldEndVnode = oldChildren[--oldEndIndex]\r\n      newStartVnode = newChildren[++newStartIndex]\r\n    }else{\r\n      // console.log('---------------乱序比对-----------');\r\n      let moveIndex = map[newStartVnode.key];\r\n      \r\n      if(moveIndex != undefined){\r\n        let moveVnode = oldChildren[moveIndex];  //找到对应的节点进行服用\r\n        // 如果在老节点中找到节点 ，将节点移到当前老节点得开始节点前  \r\n        el.insertBefore(moveVnode.el,oldStartVnode.el)\r\n        oldChildren[moveIndex] = undefined;// 并把 老节点的值设为空 表示这个节点已经移走了\r\n    \r\n        patchVnode(moveVnode,newStartVnode)  //比较属性和子节点\r\n      }else{\r\n        el.insertBefore(createElm(newStartVnode),oldStartVnode.el)\r\n      }\r\n      newStartVnode = newChildren[++newStartIndex]\r\n    }\r\n\r\n  }\r\n\r\n  //1.头大于尾  old: a b c   new:a b c d 新的多余就插入\r\n  //2.尾大于头 old:b c d   new:a b c d 新的多余就插入\r\n  if(newStartIndex <= newEndIndex){\r\n    for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n      let childEl = createElm(newChildren[i]);\r\n      \r\n      // 第一种情况（从左往右比对）结束  头指针大于尾指针 则新节点最后一个+1不存在，appendChild新节点\r\n      // 第二种情况（从右往左比对）结束 头指针小于尾指针 当前比对节点的下一个存在，进行插入\r\n      let anchor = newChildren[newEndIndex + 1]?newChildren[newEndIndex + 1].el:null;\r\n      // anchor为 null，则将指定的节点添加到指定父节点的子节点列表的末尾。相当于appendChild\r\n      el.insertBefore(childEl,anchor)\r\n    }\r\n  }\r\n\r\n  // 第一种情况（从左往右比对）结束 和 第二种情况（从右往左比对）结束 老 头指针头小于尾指针\r\n  if(oldStartIndex <= oldEndIndex){\r\n\r\n    for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n      if(oldChildren[i]){// 乱序比对后  复用的老节点设为空值 \r\n        let childEl = oldChildren[i].el;\r\n        el.removeChild(childEl)\r\n      }\r\n    }\r\n  }\r\n\r\n}","/**\r\n * vue核心流程\r\n * 1. 创造了响应式数据\r\n * 2. 模板转换成ast语法树\r\n * 3. 将ast语法树转换成render函数\r\n * 4. 后续每次数据更新可以只执行render函数（无需再次执行ast转化过程）\r\n */\r\n\r\nimport Watcher from \"./Observer/watcher\";\r\nimport { createElementVNode,createTextVNode} from \"./vdom/index\";\r\nimport { patch } from \"./vdom/patch\";\r\n\r\nexport function initLifeCycle(Vue){\r\n  Vue.prototype._update = function(vnode){\r\n    const vm = this;\r\n    let el = vm.$el;  \r\n\r\n    // 将组件第一次产生的虚拟节点保存在_vnode上\r\n    let preVnode = vm._vnode;\r\n    vm._vnode = vnode;\r\n\r\n    // 通过判断是否是第一次渲染，如果不是 传入上次的渲染节点 进行diff算法比较\r\n    if(preVnode){\r\n      vm.$el = patch(preVnode,vnode)\r\n    }else{\r\n      // 这里patch既有初始化方法  又有更新（vm.$el重新赋值新的节点） \r\n      vm.$el = patch(el,vnode);\r\n    }\r\n    \r\n  }\r\n\r\n  Vue.prototype._render = function(){\r\n    // console.log('this.$options.render',this.$options.render);\r\n    // 指向Vue 因为render函数使用with 当this传入vm的时候，_s(xxx)中的变量会自动去vm上拿取\r\n    return this.$options.render.call(this);\r\n  }\r\n\r\n  Vue.prototype._c = function(){\r\n    // console.log('1',arguments);\r\n    return createElementVNode(this,...arguments)\r\n  }\r\n  Vue.prototype._v = function(){\r\n    // console.log('2',arguments);\r\n    return createTextVNode(this,...arguments);\r\n  }\r\n\r\n  // 因为render函数使用with的原因 所以_s(xxx)中的变量 可以直接获取对应的值\r\n  Vue.prototype._s = function(value){\r\n    // console.log('3',value);\r\n    if( typeof value !== 'object') return value;\r\n    return JSON.stringify(value);\r\n  }\r\n}\r\n\r\nexport function mountComponent(vm,el){\r\n  vm.$el = el;\r\n\r\n  // 1.调用render方法产生虚拟节点，虚拟DOM\r\n  // console.log('vm----------',vm,vm._render());\r\n\r\n  console.log('-----------mountComponent-----------');\r\n  const updateComponents = ()=>{\r\n    vm._update(vm._render()); // 更新组件渲染\r\n  }\r\n  // debugger\r\n  // watcher 相当于一个观察者  dep则是收集者 \r\n  let watcher = new Watcher(vm,updateComponents,true) //true 用于标识 是一个渲染watcher\r\n\r\n  console.log('watcher',watcher);\r\n  // 2.根据虚拟DOM产生真实DOM\r\n\r\n  // 3.插入到el元素中\r\n}\r\n\r\n// 生命周期钩子遍历执行\r\nexport function calHook(vm,hook){\r\n  // console.log('hook',hook);\r\n  // 如果钩子函数的数组存在\r\n  const handles = vm.$options[hook];\r\n  \r\n  handles && handles.forEach(handle=>handle())\r\n}","\r\nlet oldArrayProto = Array.prototype;  //获取数组原型\r\n\r\n// 获取新的实例原型  不影响原数组方法\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n// 找到所有变异方法\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reverse',\r\n  'sort',\r\n  'splice',\r\n]\r\n\r\nmethods.forEach(method=>{\r\n  // 数组方法的重新\r\n  newArrayProto[method] = function(...args){\r\n\r\n    // console.log('------this-----',this,args);\r\n    \r\n    // 内部还是调用了原来的方法\r\n    const result = oldArrayProto[method].call(this,...args);\r\n\r\n    // 我们对新增的数据进行劫持\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n\r\n    switch(method){\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args;\r\n        break;\r\n      case 'splice':  //arr.splice(0,1,{age:18},{a:1})\r\n        inserted = args.slice(2)\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if(inserted){\r\n      // 对新增的内容再次进行观测\r\n      ob.observeArray(inserted);\r\n    }\r\n\r\n    // 数组更新\r\n    ob.dep.notify();\r\n    return result;\r\n  }\r\n})\r\n\r\n","import { newArrayProto } from \"./array\";\r\nimport Dep from \"./dep\";\r\n\r\nclass Observer{\r\n  constructor(data){\r\n    \r\n    // 为了让每个对象都有一个依赖收集\r\n    this.dep = new Dep();\r\n    // 为了数组能够使用 observeArray 去观测新增的数据\r\n    Object.defineProperty(data,'__ob__',{\r\n      value:this,\r\n      enumerable:false\r\n    })\r\n\r\n    // console.log('-------',data);\r\n    // 如果是数组就不再一个个劫持  太浪费性能了 (数组劫持的核心，就是重写数组的方法，对新增的属性进行判断和观测)\r\n    if(Array.isArray(data)){\r\n      // 对数组7个变异方法进行重写\r\n      data.__proto__ = newArrayProto;\r\n\r\n      // 如果数组中放的是对象，可以检测其变化\r\n      this.observeArray(data)\r\n    }else{\r\n      // Object.defineProperty 只能劫持已经存在的属性（vue里面会为此单独写一些api $set $delete）\r\n      this.walk(data);\r\n    }\r\n  }\r\n\r\n  // 循环对象依次进行劫持\r\n  walk(data){\r\n    // “重新定义” 属性 因此vue2性能会有点差\r\n    Object.keys(data).forEach(key=>{defineReactive(data,key,data[key])})\r\n  }\r\n\r\n  // 观测数组 对数组中的对象进行劫持\r\n  observeArray(data){\r\n    data.forEach(item=>{observe(item)})\r\n  }\r\n}\r\n\r\n// 如果数组中还有数组或者对象 接着进行依赖收集\r\nfunction dependArray(value){\r\n  for(let i; i <value.length; i++){\r\n    let current = value[i];\r\n    current.__ob__ && current.__ob__.dep.depend()\r\n    if(Array.isArray(current)){\r\n      dependArray(current)\r\n    }\r\n  }\r\n  // console.log('dependArray',value);\r\n}\r\n\r\n// 数据劫持  闭包 属性劫持\r\nexport function defineReactive(target,key,value){\r\n  // 如果值是对象再次进行劫持\r\n  let childDep =  observe(value)\r\n\r\n  let dep = new Dep();\r\n  // console.log('-------dep-----------',dep.id,key,value);\r\n  Object.defineProperty(target,key,{\r\n    get(){\r\n      // 让这个属性的收集器记住当前的watcher  \r\n      // console.log('Dep.target',Dep.target);\r\n      if(Dep.target){  //注意这里只是 首次的data函数中的属性 进行的依赖收集 \r\n        dep.depend();\r\n\r\n        // 这里是让 里面的数组和对象也进行依赖收集 为了修改时候调用更新操作\r\n        if(childDep){\r\n          childDep.dep.depend();\r\n          \r\n          // 如果里面还嵌套数组 也进行依赖收集\r\n          if(Array.isArray(value)){\r\n            dependArray(value)\r\n          }\r\n        }\r\n      }\r\n      console.log('获取',key);\r\n      return value;\r\n    },\r\n    set(newVal){\r\n      console.log('设置');\r\n      if(newVal === value)return;\r\n\r\n      observe(newVal)// 用户给新值重新赋值对象，需要再次代理\r\n      \r\n      value = newVal\r\n\r\n      // 重新渲染页面\r\n      dep.notify()\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(data){\r\n  // 只对对象进行劫持\r\n  if(typeof data != 'object' || data == null)return;\r\n\r\n  // 说明对象已经被代理过了\r\n  if(data.__ob__ instanceof Observer){\r\n    return data.__ob__;\r\n  }\r\n\r\n  // 若果一个对象被劫持过了，那就不需要再被劫持了（要判断一个对象是否被劫持过，可以添加一个实例，用实例来判断是否被劫持过）\r\n  return new Observer(data)\r\n}","import Dep from \"./Observer/dep.js\";\r\nimport { observe } from \"./Observer/index.js\";\r\nimport Watcher, { nextTick } from \"./Observer/watcher\";\r\n\r\nexport function initState(vm){\r\n  const opts = vm.$options;\r\n\r\n  if(opts.data){\r\n    initData(vm)\r\n  }\r\n\r\n  if(opts.computed){\r\n    initComputed(vm)\r\n  }\r\n\r\n  if(opts.watch){\r\n    ininWatch(vm);\r\n  }\r\n}\r\n\r\n// 数据初始化\r\nfunction initData(vm){\r\n  let data = vm.$options.data; //data可能是函数和对象 vue3认定是函数\r\n\r\n  // 疑问这里data函数的指向就是vm 为什么要call\r\n  data = typeof data =='function'?data.call(vm):data;\r\n \r\n  vm._data = data;  //将返回的对象放到_data上\r\n\r\n  // 对于数据进行劫持 vue2里采用了一个api defineProperty\r\n  observe(data)\r\n\r\n  // 将vm._data 用vm来代理  方便用户获取\r\n  for(let key in data){\r\n    proxy(vm,'_data',key)\r\n  }\r\n}\r\n\r\n// vm.xxx  代理到 vm._data.xxx\r\nfunction proxy(vm,target,key){\r\n  Object.defineProperty(vm,key,{\r\n    get(){\r\n      return vm[target][key]\r\n    },\r\n\r\n    set(value){\r\n      vm[target][key] = value;\r\n    }\r\n  })\r\n}\r\n\r\n// watch 初始化 \r\nfunction ininWatch(vm){\r\n  let watch = vm.$options.watch;\r\n  for (const key in watch) {\r\n    // （可以是字符串 数组 对象）\r\n    let handler = watch[key]; \r\n\r\n    if(Array.isArray(handler)){\r\n      for (let i = 0; i < handler.length; i++) {\r\n        createWatcher(vm,key,handler)\r\n      }\r\n    }else{\r\n      createWatcher(vm,key,handler)\r\n    }\r\n  }\r\n}\r\n\r\n// 1：watch:{name:'fn'}\r\n// 2：watch:{name:()=>{}}\r\n// 3：watch:{name:[()=>{},()=>{}]}\r\n// 4:vm.$watch(()=>vm.name,()=>{})\r\n\r\nfunction createWatcher(vm,key,handler){\r\n  // 也就是调用methods中的方法fn 例：watch:{name:'fn'}\r\n  if(typeof handler === 'string'){\r\n    handler = vm[handler];\r\n  }\r\n  return vm.$watch(key,handler)\r\n}\r\n\r\n// 初始化 computed函数\r\nfunction initComputed(vm){\r\n  const computed = vm.$options.computed;\r\n  let watchers = vm._computedWathcers  ={};\r\n  // debugger\r\n  for (const key in computed) {\r\n    const userDef = computed[key];\r\n\r\n    let fn = typeof userDef == 'function'?userDef:userDef.get;\r\n\r\n    // 每个计算属性 对应一个计算watcher  默认lazy 首次不触发 视图更新操作\r\n    // 此刻的计算watcher的get方法 就是当前计算属性的get方法\r\n    watchers[key] = new Watcher(vm,fn,{lazy:true})\r\n    // console.log('watchers[key]',watchers[key]);\r\n    defineComputed(vm,key,userDef);\r\n  }\r\n}\r\n\r\n// 定义计算属性\r\nfunction defineComputed(target,key,userDef){\r\n  const setter = userDef.set || (()=>{})\r\n  Object.defineProperty(target,key,{\r\n    get:createComputedGetter(key),\r\n    set:setter\r\n  })\r\n}\r\n\r\n// 创建一个计算属性控制器 用于控制页面多次调用计算属性只执行一次\r\n// 计算属性根本不会去收集依赖，只会让自己的依赖属性去收集依赖\r\nfunction createComputedGetter(key){\r\n  return function(){\r\n    let watcher = this._computedWathcers[key]; //获取到对应计算属性的watcher\r\n\r\n    // console.log('createComputedGetter',watcher.dirty);\r\n    if(watcher.dirty){\r\n      // 如果用户传入的数据是脏的就去执行传入的函数\r\n      watcher.evaluate();\r\n    }\r\n\r\n    // 这里的是渲染watcher了 让计算属性记住渲染watcher 用于当值变化地时候 即调用计算watcher更新值，也调用渲染watcher更新视图\r\n    if(Dep.target){\r\n      watcher.depend();\r\n    }\r\n\r\n    return watcher.value;\r\n  }\r\n}\r\n\r\nexport function initStateMixin(Vue){\r\n  Vue.prototype.$nextTick = nextTick;\r\n\r\n  // 创建watch 即组件自己的的watcher\r\n  Vue.prototype.$watch = function(exprOrFn,cb){\r\n    new Watcher(this,exprOrFn,{user:true},cb)\r\n  }\r\n}","import { compileToFunction } from \"./compiler/index\";\r\nimport { calHook, mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\nimport { mergeOptions } from \"./utils\";\r\n\r\nexport function initMinx(Vue){\r\n  // 初始化\r\n  Vue.prototype._init = function(options){\r\n    const vm = this;\r\n\r\n    // this.constructor.options  是gloabAPI.js 中 定义的\r\n    vm.$options = mergeOptions(this.constructor.options,options)\r\n    // vm.$options = options;// 将选项挂载到实例上  data,create,methods...\r\n\r\n    calHook(vm,'beforeCreate')\r\n    // 状态初始化\r\n    console.log('---------------initState--------------',options);\r\n    initState(vm)\r\n\r\n    calHook(vm,'created')\r\n    // 模板初始化\r\n    if(options.el){\r\n      vm.$mount(options.el)\r\n    }\r\n  }\r\n\r\n  Vue.prototype.$mount = function(el){\r\n    const vm = this;\r\n    let ops = vm.$options;\r\n    el = document.querySelector(el);\r\n    \r\n    // 先看有没有render函数\r\n    if(!ops.render){\r\n      let template;\r\n\r\n      if(!ops.template && el){\r\n        template = el.outerHTML;\r\n      }else{\r\n        template = ops.template;\r\n      }\r\n      \r\n      // 去生成render函数\r\n      if(template){\r\n        // 对模板进行编译\r\n        const render = compileToFunction(template)\r\n        ops.render = render;\r\n      }\r\n    }\r\n\r\n    // 组件挂载\r\n    mountComponent(vm,el)\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n ","import { initGlobalAPI } from \"./gloabAPI\";\r\nimport { initMinx } from \"./init\";\r\nimport { initLifeCycle } from \"./lifecycle\";\r\nimport { initStateMixin } from \"./state\";\r\nimport {compileToFunction} from './compiler/index'\r\nimport { createElm, patch} from \"./vdom/patch\";\r\n\r\n// 不使用class 去创建类 是为了避免所有的方法耦合在一起\r\nfunction Vue(options){\r\n  // 初始化\r\n  this._init(options)\r\n}\r\n\r\n\r\n// 扩展了init 方法\r\ninitMinx(Vue);\r\n// vm._update  vm._render\r\ninitLifeCycle(Vue)\r\n// 全局api的实现\r\ninitGlobalAPI(Vue)\r\n// 实现了 nextTick $watch\r\ninitStateMixin(Vue)\r\n\r\n\r\n// -------------------为了方便观察前后的虚拟节点 ‘测试’-----------------\r\n// 生成虚拟节点的过程\r\n// 1.调用compileToFunction函数对模板进行编译，生成render函数\r\n// 2.调用render函数，生成虚拟dom树结构\r\n// 3.调用patch生成真实dom节点并替旧节点\r\n\r\n{/* <li key='a'>a</li>\r\n  <li key='b'>b</li>\r\n  <li key='c'>c</li>\r\n  <li key='d'>d</li> */}\r\n// let render1 = compileToFunction(`<ul key='a' a='1' style='color:#f99'>\r\n//   <li>e</li>\r\n//   <li>c</li>\r\n//   <li>f</li>\r\n//   <li>g</li>\r\n// </ul>`)\r\n// let vm1 = new Vue({data:{name:'你好'}})\r\n// let preVNode = render1.call(vm1);\r\n// // console.log('preVNode',render1,preVNode);\r\n// let el = createElm(preVNode)\r\n// document.body.appendChild(el)\r\n\r\n// let render2 = compileToFunction(`<ul key='a' a='1' style='color:#f99;background:#ff6700'>\r\n//   <li>d</li>\r\n//   <li>a</li>\r\n//   <li>b</li>\r\n//   <li>c</li>\r\n// </ul>`)\r\n// let vm2 = new Vue({data:{name:'哒哒哒看'}})\r\n// let nextVNode = render2.call(vm2);\r\n\r\n\r\n// setTimeout(()=>{\r\n//   patch(preVNode,nextVNode)\r\n// },1500)\r\n\r\nexport default Vue;"],"names":["strats","LIFYCYCLE","forEach","hook","p","c","concat","components","parentVal","childVal","res","Object","create","key","mergeOptions","parent","child","options","mergeField","hasOwnProperty","console","log","initGlobalAPI","Vue","_base","mixin","extend","Sub","_init","prototype","constructor","component","id","definition","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","TEXT_TYPE","ELEMENT_TYPE","stack","currentParent","root","createASTElement","tag","attrs","children","type","start","node","push","chars","text","trim","end","pop","length","advance","n","substring","parseStartTag","match","tagName","attr","name","value","textEnd","indexOf","startTagMatch","endTagMatch","defaultTagRE","genProps","str","i","obj","split","map","item","JSON","stringify","slice","genChildren","gen","join","codegen","test","tokens","lastIndex","exec","index","ast","code","compileToFunction","template","render","Function","Dep","subs","target","addDep","watcher","update","pushTarget","popTarget","Watcher","vm","exprOrFn","cb","renderWatcher","getter","deps","depId","Set","lazy","dirty","user","undefined","get","dep","has","add","addSub","depend","call","queueWatcher","oldVal","newVal","queue","pending","flashSchedulerQueue","flashQueue","q","run","nextTick","callbacks","waiting","timerFunc","flashCallback","cbs","Promise","resolve","then","MutationObserver","observer","textNode","document","createTextNode","observe","characterData","textContent","setImmediate","setTimeout","isReservedTag","includes","createElementVNode","data","vnode","$options","Ctor","createComponentVnode","init","instance","componentInstance","componentOptions","$mount","createTextVNode","isSameVnode","vnode1","vnode2","createComponent","createElm","$el","el","createElement","patchProps","appendChild","oldprops","props","oldStyle","style","newStyle","removeAttribute","styleName","setAttribute","patch","oldVNode","isRealElement","nodeType","elm","parentElm","parentNode","newElm","insertBefore","nextSibling","removeChild","patchVnode","replaceChild","oldChildren","newChildren","updateChildren","mountChildren","innerHTML","oldStartIndex","newStartIndex","oldEndIndex","newEndIndex","oldStartVnode","newStartVnode","oldEndVnode","newEndVnode","makeIndexByKey","moveIndex","moveVnode","childEl","anchor","initLifeCycle","_update","preVnode","_vnode","_render","_c","arguments","_v","_s","mountComponent","updateComponents","calHook","handles","handle","oldArrayProto","Array","newArrayProto","methods","method","args","result","inserted","ob","__ob__","observeArray","notify","Observer","defineProperty","enumerable","isArray","__proto__","walk","keys","defineReactive","dependArray","current","childDep","set","initState","opts","initData","computed","initComputed","watch","ininWatch","_data","proxy","handler","createWatcher","$watch","watchers","_computedWathcers","userDef","fn","defineComputed","setter","createComputedGetter","evaluate","initStateMixin","$nextTick","initMinx","ops","querySelector","outerHTML"],"mappings":"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"}